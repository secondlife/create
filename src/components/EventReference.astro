---
/**
 * EventReference component - Shared base for event documentation
 *
 * This component provides the core rendering logic for event reference pages.
 * Language-specific components (LSLEvent, LuaEvent) use this as their base.
 */

import { Code } from '@astrojs/starlight/components';
import type { EventDefinition, Argument } from '../utils/lsl-definitions';
import '../styles/function-reference.css';

export interface EventReferences extends EventDefinition {
  /** The programming language for syntax highlighting */
  language: 'lsl' | 'lua';
  /** The formatted event signature */
  signature: string;
  /** CSS class name for the root element */
  className?: string;
}

export interface Props extends EventReferences {}

const {
  tooltip,
  deprecated,
  experience,
  godMode,
  arguments: args = [],
  language,
  signature,
  className = 'event-reference'
} = Astro.props;

// Split tooltip into paragraphs by newlines
const tooltipParagraphs = tooltip ? tooltip.split('\n').filter((p: string) => p.trim()) : [];
---

<div class={className}>
  <div class="function-header">
    {deprecated && (
      <div class="badge badge-warning">Deprecated</div>
    )}
    {experience && (
      <div class="badge badge-info">Requires Experience</div>
    )}
    {godMode && (
      <div class="badge badge-danger">God Mode Only</div>
    )}
  </div>

  <div class="function-signature">
    <Code code={signature} lang={language} />
  </div>

  <div class="function-description">
    {tooltipParagraphs.map((paragraph: string) => (
      <p>{paragraph}</p>
    ))}
  </div>

  {Object.keys(args).length > 0 && (
    <details class="function-parameters-details">
      <summary>Parameters</summary>
      <div class="function-parameters">
        <dl>
          <slot name="parameters">
            {Object.values(args).map((arg: Argument) => (
              <>
                <dt>
                  <code>{arg.name}</code>
                  <span class="param-type">({arg.type})</span>
                </dt>
                <dd>{arg.tooltip}</dd>
              </>
            ))}
          </slot>
        </dl>
      </div>
    </details>
  )}
</div>
